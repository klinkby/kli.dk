---
date: "2021-04-08T20:00:00Z"
title: "Cloudflare Worker"
description: "Can you add HTTP security headers and handle 404 responses properly in static websites? I use a 
@Cloudflare Worker"
tags:
- www
- cms
- cloud
- security
images:
- "/images/2021/cfw.jpg"

---

# Adding a CloudFlare Worker 

This static website is generated by [Hugo](../../2020/hugo) to Azure Storage blob-based static website and served from CloudFlare CDN. Out of the box it's pretty good. CloudFlare's encryption is graded [A+ on SSLLabs](https://www.ssllabs.com/ssltest/analyze.html?d=kli.dk&latest). 

In the CloudFlare dashboard I added Page Rules to redirect naked root domain requests to `www` and enable CloudFlare's minifier + cache. To add strict security HTTP headers and proper `404 Not Found` responses, I had to turn to [CloudFlare Workers](https://workers.cloudflare.com/), i.e. simple NodeJS script that runs in the CloudFlare pipeline between edge cache and origin server.

![image](/images/2021/cfw.jpg) 

Heavily inspired by [Scott Helme](https://scotthelme.co.uk/security-headers-cloudflare-worker/) I wrote this https://gist.github.com/klinkby/8e161a3e2926ecc7d7b53a5c57bf0790 , which provide an [A grade](https://securityheaders.com/?q=https%3A%2F%2Fwww.kli.dk%2F) in Scott's security headers analyzer.

‚ù§ serverless.